<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Canvas Drawing</title>
  <style>
    body {
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #f0f0f0;
    }
    canvas {
      border: 2px solid #000;
    }
  </style>
</head>
<body>
  <input type="file" id="bgImageInput" accept="image/*">
  <canvas id="myCanvas" width="800" height="500"></canvas>
  <button id="penBtn">Pen</button>
  <button id="eraserBtn">Eraser</button>
  <script>
    const canvas = document.getElementById('myCanvas');
    const context = canvas.getContext('2d');
    let isDrawing = false;
    let isErasing = false;
    let isWriting = false;
    let text = '';

    // Load background image
    function loadImage(event) {
      const file = event.target.files[0];
      const reader = new FileReader();
      reader.onload = function() {
        const img = new Image();
        img.onload = function() {
          canvas.width = img.width;
          canvas.height = img.height;
          context.drawImage(img, 0, 0);
        };
        img.src = reader.result;
      };
      reader.readAsDataURL(file);
    }

    // Event listener for changing background image
    const bgImageInput = document.getElementById('bgImageInput');
    bgImageInput.addEventListener('change', loadImage);

    // Pen and Eraser button functionality
    const penBtn = document.getElementById('penBtn');
    const eraserBtn = document.getElementById('eraserBtn');

    penBtn.addEventListener('click', () => {
      isDrawing = true;
      isErasing = false;
      isWriting = false;
    });

    eraserBtn.addEventListener('click', () => {
      isDrawing = false;
      isErasing = true;
      isWriting = false;
    });

    // Drawing, erasing, and writing functionality
    canvas.addEventListener('mousedown', startDrawing);
    canvas.addEventListener('mouseup', endDrawing);
    canvas.addEventListener('mousemove', drawOrErase);
    canvas.addEventListener('click', writeText);

    function startDrawing() {
      isDrawing = true;
      isErasing = false;
      isWriting = false;
    }

    function endDrawing() {
      isDrawing = false;
      isErasing = false;
      isWriting = false;
    }

    function drawOrErase(e) {
      if (isDrawing || isErasing) {
        const x = e.clientX - canvas.offsetLeft;
        const y = e.clientY - canvas.offsetTop;

        context.lineWidth = 5;
        context.lineCap = 'round';

        if (isDrawing) {
          context.strokeStyle = '#000'; // Set color to draw
        } else if (isErasing) {
          context.strokeStyle = canvas.style.backgroundColor; // Match canvas background color for eraser
        }

        if (isDrawing || isErasing) {
          if (!isDrawing) {
            context.globalCompositeOperation = 'destination-out'; // For erasing effect
          } else {
            context.globalCompositeOperation = 'source-over'; // Drawing mode
          }

          if (!isDrawing) {
            context.lineTo(x, y);
            context.stroke();
            context.beginPath();
            context.moveTo(x, y);
          }
        }
      }
    }

    function writeText(e) {
      if (isWriting) {
        const x = e.clientX - canvas.offsetLeft;
        const y = e.clientY - canvas.offsetTop;

        context.font = '20px Arial';
        context.fillStyle = '#000';
        context.fillText(text, x, y);
        isWriting = false;
      }
    }

    // Prompt for text input when pen button is clicked
    penBtn.addEventListener('click', () => {
      text = prompt('Enter text:');
      if (text !== null) {
        isWriting = true;
      }
    });

    // Clear text when eraser button is clicked
    eraserBtn.addEventListener('click', () => {
      text = '';
    });
  </script>
</body>
</html>
